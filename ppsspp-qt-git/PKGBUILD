# Maintainer: Thiago Kenji Okada <thiago DOT mast3r AT gmail DOT com>
# Based on ppsspp-git PKGBUILD from  Clement Guerin <geecko.dev@free.fr>
# and with Qt build instructions from here:
# https://github.com/hrydgard/ppsspp/issues/4449

pkgname=ppsspp-qt-git
pkgver=v0.9.5.r575.g7407be9
pkgrel=1
pkgdesc="A PSP emulator for Android, Windows, Mac, and Linux, written in C++ \
    with Qt UI."
arch=('i686' 'x86_64')
url="http://www.ppsspp.org/"
license=('GPL2')
depends=('zlib' 'sdl' 'qt4')
makedepends=('git' 'cmake' 'gcc')
optdepends=()
provides=('ppsspp')
source=('ppsspp::git://github.com/hrydgard/ppsspp.git#branch=master'
        'ppsspp.desktop')
md5sums=('SKIP'
        '489e0d8caed3c133e16bc6c59443f2af')

pkgver() {
    cd "$srcdir/ppsspp"
    git describe --long | sed -E 's/([^-]*-g)/r\1/;s/-/./g'
}

build() {
    cd $srcdir/ppsspp

    git submodule update --init

    export LDFLAGS="-lavutil -lavformat -lavcodec -lswscale -lswresample"

    mkdir build
    pushd build
    cmake ..
    make
    popd

    mkdir build-qt
    pushd build-qt
    qmake-qt4 ../Qt/PPSSPPQt.pro
    make
    popd
}

package() {
    cd $pkgdir

    mkdir -p $pkgdir/usr/bin
    mkdir -p $pkgdir/usr/share/icons/hicolor/scalable/apps
    mkdir -p $pkgdir/usr/share/applications/

    install -m755 $srcdir/ppsspp/build-qt/PPSSPPQt \
        $pkgdir/usr/bin/PPSSPPQt
    install -m644 $srcdir/ppsspp/assets/icon-114.png \
        $pkgdir/usr/share/icons/hicolor/48x48/apps/ppsspp.png
    install -Dm644 $srcdir/ppsspp.desktop \
        $pkgdir/usr/share/applications/ppsspp.desktop
}

# vim: tabstop=8 expandtab shiftwidth=4 softtabstop=4
